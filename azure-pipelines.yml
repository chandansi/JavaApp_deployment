trigger:
- main   # builds automatically on pushes to main

pool: pip_agent
  

variables:
  MAVEN_HOME: 'C:\maven-mvnd-1.0.3-windows-amd64'  # adjust if needed

stages:
- stage: Build
  jobs:
  - job: BuildJavaApp
    displayName: "Build Java Login Project"
    steps:

    # Step 1: Use built-in Java 21
    - task: PowerShell@2
      inputs:
        targetType: 'inline'
        script: |
          - task: UseJavaVersion@1
                inputs:
                  versionSpec: '21'
                  jdkArchitecture: 'x64'

    # Step 2: Verify Java and Maven
    - script: |
        echo "Java version:"
        java -version
        echo "MVND version:"
        $(MAVEN_HOME)\bin\mvnd.cmd -v
      displayName: "Verify Java & MVND"

    # Step 3: Build project with MVND
    - script: |
        echo "Building project..."
        set PATH=$(MAVEN_HOME)\bin;%PATH%
        cd $(Build.SourcesDirectory)\JavaLoginPracticeApp
        mvnd.cmd clean package
      displayName: "Build with MVND"

    # Step 4: Publish WAR artifact
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Build.SourcesDirectory)\JavaLoginPracticeApp\target'
        ArtifactName: 'JavaApp_WAR'
        publishLocation: 'Container'
